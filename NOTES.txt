#! Ultimate Docker Series Notes

#! Introduction
This is a zero to hero tutorial on how to build and run containers in docker.
* We will cover learn docker with full stack application consisting of Frontend, Backend and Database.
* This will be a highly comprehensive and practical tutorial.

#! Prerequisites
1. No pre-requisites required.
2. Knowledge of basic Frontend, Backend and Database.
3. Basic familiarity with Git.

#! How to follow this course
1. Make notes 
2. Keywords
3. Play along with the commands

---------------------------------------------------------------------------

#* Section - 1 - Docker Basics
* What is Docker?
* Virtual Machine vs containers
* Architecture of Docker
* Installing Docker
* Development Workflow

#! What is Docker?
Docker is an open-source platform that automates the deployment, scaling, and management of applications using containerization technology. Containers allow developers to package up an application with all its dependencies into a standardized unit for software development. This ensures that the application runs quickly and reliably from one computing environment to another.

** Key Concepts
Container: A lightweight, standalone, executable package that includes everything needed to run a piece of software, including the code, a runtime, libraries, environment variables, and config files.
Image: A read-only template with instructions for creating a Docker container. Images are built from a "Dockerfile" which contains a list of commands that the Docker daemon uses to build an image.
Docker Daemon: The background service running on the host that manages building, running, and distributing Docker containers.
Docker Client: The command-line tool or API that allows users to talk to the Docker daemon.

#TODO => Refer the architecture diagram of Docker

* A platform for building, running, and shipping applications
* Prevents the issue of "It works on my machine..."
Solves issues like:
a) One or more files missing
b) Software version mismatch
c) Different configuration settings

* With docker, we can easily package up our application and run it on any machine.
* If someone new joins the team, they can install docker and run their application.

* docker-compose up => used to run multiple containers
* docker-compose down => used to stop multiple containers
* docker-compose dowm -rmi all => used to stop and remove all containers

#! Virtual Machine vs containers
* Virtual Machine: A physical machine that is used for running applications in a virtualized environment. This is used in a variety of applications.
* Container: A lightweight, standalone, executable package that includes everything needed to run a piece of software, including the code, a runtime, libraries, environment variables, and config files.

Problems with Virtual Machine:
a) Each VM needs a full-blown OS
b) Slow to start
c) Resource intensive

Benifits of Containers:
a) Allow running multiple apps in isolation
b) Lightweight
c) Use OS of the host machine
d) Start quickly
e) Need less hardware resources

#! Architecture of Docker
* Docker uses a client server architecture
* A kernel manages applications and hardware resources
* Docker's architecture is designed to simplify the deployment and scaling of applications by packaging them in containers along with their dependencies. This ensures consistency across different stages of the application lifecycle, from development to testing to production. The combination of Docker images, containers, the Docker engine, and the client-server model provides a powerful and flexible platform for modern application development and deployment.

#! Installing Docker
* If you already have docker, find its version using "docker version"
"
PS D:\Ultimate-Docker-Series> docker version
Client:
 Version:           27.0.3
 API version:       1.46
 Go version:        go1.21.11
 Git commit:        7d4bcd8
 Built:             Sat Jun 29 00:03:32 2024
 OS/Arch:           windows/amd64
 Context:           desktop-linux
"
* Go to the official docker website and download docker using "download from docker hub" 
* Then setup the WSL2 too if you encounter any issues.

* To verify that Docker is installed correctly, open a Command Prompt window and type To verify that Docker is installed correctly, open a Command Prompt window and type docker run hello-world. This command downloads a test image and runs it in a container. When the container runs, it prints an informational message and exits.. This command downloads a test image and runs it in a container. When the container runs, it prints an informational message and exits.
"
PS D:\Ultimate-Docker-Series> docker run hello-world
Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
c1ec31eb5944: Pull complete
Digest: sha256:1408fec50309afee38f3535383f5b09419e6dc0925bc69891e79d84cc4cdcec6
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub. (amd64)
 3. The Docker daemon created a new container from that image which runs the executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it to your terminal.

To try something more ambitious, you can run an Ubuntu container with: $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID: https://hub.docker.com/

For more examples and ideas, visit: https://docs.docker.com/get-started/
"

#! Development Workflow
1. We create a Dockerfile in the root of our project which contains the instructions to build the image. This image contains everything needed to run the application. 
2. The image can contain:
a) a cut-down OS
b) a runtime environment
c) application files
d) third-party libraries
e) environment variables
f) config files

* Once we have a image, we tell docker to start a container using that image.
* We can then use that container to run our application.
* docker run <image name> => This will start a container based on the image

* Once we complete our application, we can create a image and push it to the registry i.e Docker Hub which is similar to the concept of Git and GitHub.
* "docker push <image name>" => This will push the image to the registry
* Then you can pull it to any machine using "docker pull <image name>"

#! Docker in Action ( A small walkthrough )
Steps:
1. Start with an OS
2. Install Node
3. Copy app files
4. Run "node app.js"

1. Create a HELLO-DOCKER directory
2. Create a app.js file with a console message.
3. Test app.js working with "node app.js"
4. Create a Dockerfile with instructions to build the image:
"
#! We are using # Use Node.js Alpine image as the base image from the DockerHub
FROM node:alpine

#! Copy all the files in the present directory to a new directory named "app" inside the container
COPY . /app 

#! Approach 1 (Run the command by giving the complete path)
# CMD node /app/app.js   

#! Approach 2 (Run the command by giving the relative path i.e set the working directory first, then run the command)
#! Set the working directory inside the container to "/app"
WORKDIR /app

#! Run the command "node app.js"
# CMD node app.js

#! Run the command to start the application
CMD ["node", "app.js"]
"
5. Now we need to build our image.
6. "docker build -t hello-docker .\HELLO-DOCKER\" => This will build the image. 
* -t means tag it with hello-docker.
* .\HELLO-DOCKER\ means the directory where our Dockerfile is located.
"
PS D:\Ultimate-Docker-Series> docker build -t hello-docker .\HELLO-DOCKER\
[+] Building 1.1s (8/8) FINISHED                                                                                                                                                                                                          docker:desktop-linux
 => [internal] load build definition from Dockerfile                                                                                                                                                                                                      0.0s
 => => transferring dockerfile: 664B                                                                                                                                                                                                                      0.0s 
 => [internal] load metadata for docker.io/library/node:alpine                                                                                                                                                                                            1.0s 
 => [internal] load .dockerignore                                                                                                                                                                                                                         0.0s 
 => => transferring context: 2B                                                                                                                                                                                                                           0.0s 
 => [internal] load build context                                                                                                                                                                                                                         0.0s 
 => => transferring context: 57B                                                                                                                                                                                                                          0.0s 
 => [1/3] FROM docker.io/library/node:alpine@sha256:be6983df6443f143f9e9ba8dff99b44c14556093abc8d1501064a1aff2c372d4                                                                                                                                      0.0s 
 => CACHED [2/3] COPY . /app                                                                                                                                                                                                                              0.0s 
 => CACHED [3/3] WORKDIR /app                                                                                                                                                                                                                             0.0s 
 => exporting to image                                                                                                                                                                                                                                    0.0s 
 => => exporting layers                                                                                                                                                                                                                                   0.0s 
 => => writing image sha256:91df74adca9298f2a48b703c0c24871234b4f1b8a5c9361bc50fbf33baf78bd4                                                                                                                                                              0.0s 
 => => naming to docker.io/library/hello-docker                                                                                                                                                                                                           0.0s 

View build details: docker-desktop://dashboard/build/desktop-linux/desktop-linux/veuycsvmzak1es37extj48e68

What's next:
    View a summary of image vulnerabilities and recommendations → docker scout quickview
"
7. Type "docker image ls" or "docker images" to see all the images we have created.
"
PS D:\Ultimate-Docker-Series> docker image ls
REPOSITORY        TAG          IMAGE ID       CREATED         SIZE  
hello-docker      latest       91df74adca92   6 minutes ago   151MB 
mysql             8.0          6c54cbcf775a   3 weeks ago     572MB 
redis             latest       9c893be668ac   2 months ago    116MB 
redis             6.2-alpine   d21be8aaaa15   2 months ago    30.1MB
rnwood/smtp4dev   latest       58668bdb6a17   2 months ago    300MB 
rnwood/smtp4dev   v3           58668bdb6a17   2 months ago    300MB 
hello-world       latest       d2c94e258dcb   14 months ago   13.3kB
"
8. Type "docker run hello-docker" to run the image.
"
PS D:\Ultimate-Docker-Series> docker run hello-docker
Hello Docker!
"

#* Section - 2 - Linux Command Line
Docker is build on basic Linux concepts.
Most Docker related stuff are based on Linux commands.
Linux is like English and a very powerful command line.

#! Linux Distribution
1. They are open source software.
2. They are free to use.
3. Famous Distros: Ubuntu, Debian, Alpine, Fedora, CentOS
4. We will be using Ubuntu

#! Running Linux
1. Go to DockerHub and search fot Ubuntu. The command to get it is "docker pull ubuntu"
2. But we will use "docker run ubuntu" because it will start a container based on the image "ubuntu" but for the first time when the image is not found, it will execute "docker pull ubuntu" and then start the container of Ubuntu.
"
PS D:\Ultimate-Docker-Series> docker run ubuntu
Unable to find image 'ubuntu:latest' locally
latest: Pulling from library/ubuntu
9c704ecd0c69: Pull complete
Digest: sha256:2e863c44b718727c860746568e1d54afd13b2fa71b160f5cd9058fc436217b30
Status: Downloaded newer image for ubuntu:latest
"
3. Type "docker ps" to see all the running containers.
4. Type "docker ps -a" to see all the containers that were stopped and are not running.
"
PS D:\Ultimate-Docker-Series> docker ps        
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
PS D:\Ultimate-Docker-Series> docker ps -a
CONTAINER ID   IMAGE                    COMMAND                  CREATED              STATUS                          PORTS     NAMES
8331306a8c1e   ubuntu                   "/bin/bash"              About a minute ago   Exited (0) About a minute ago             interesting_jepsen
459ddacf061f   hello-docker             "docker-entrypoint.s…"   2 hours ago          Exited (0) 2 hours ago                    funny_wright      
e280f4894d5b   hello-world              "/hello"                 19 hours ago         Exited (0) 19 hours ago                   wizardly_jackson  
b5ff72a96c1e   redis                    "docker-entrypoint.s…"   5 days ago           Exited (0) 5 days ago                     wizardly_cray     
5030f5746047   rnwood/smtp4dev:latest   "dotnet /app/Rnwood.…"   2 weeks ago          Exited (0) 2 weeks ago                    boring_bouman
"
5. Type "docker stop <container id>" to stop the container.
6. Type "docker start <container id>" to start the container.

7. Type "docker run -it ubuntu" to start the ubuntu container in an interactive mode.
8. Type "docker run -it ubuntu bash" to start the ubuntu container in an interactive mode with bash shell.
"
PS D:\Ultimate-Docker-Series> docker run -it ubuntu
root@a20f32bebd50:/# 
"
* By default, we are logged in as a root user. We can switch to another user using "sudo" command.
* After the "@" sign, we have the name of the machine we are working on. Docker by default sets the id of the machine as the name of the container here.
* After the ":" sign, we have the present directory which is root(/) for now.
* The "#" sign means I have the highest privileges as I am a root user.
"
PS D:\Ultimate-Docker-Series> docker run -it ubuntu
root@a20f32bebd50:/# ls
bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
root@a20f32bebd50:/# cd home/
root@a20f32bebd50:/home#
"

#? Linux Commands:
* echo => Prints a message
* whoami => Prints the current user
* pwd => Prints the present working directory
* ls => Lists the files in the current directory
* cd => Changes the current directory
* echo $0 => Prints the path to bash
* history => Prints the command history

#! Managing Packages
Some of the famous package managers are:
* apt (default package manager in Ubuntu and other popular distros)
* pip 
* npm

"
PS D:\Ultimate-Docker-Series> docker run -it ubuntu
root@c06cc73cc487:/# apt
apt 2.7.14 (amd64)
Usage: apt [options] command

apt is a commandline package manager and provides commands for        
searching and managing as well as querying information about packages.
It provides the same functionality as the specialized APT tools,      
like apt-get and apt-cache, but enables options more suitable for     
interactive use by default.

Most used commands:
  list - list packages based on package names
  search - search in package descriptions
  show - show package details
  install - install packages
  reinstall - reinstall packages
  remove - remove packages
  autoremove - automatically remove all unused packages
  update - update list of available packages
  upgrade - upgrade the system by installing/upgrading packages
  full-upgrade - upgrade the system by removing/installing/upgrading packages
  edit-sources - edit the source information file
  satisfy - satisfy dependency strings

See apt(8) for more information about the available commands.
Configuration options and syntax is detailed in apt.conf(5).
Information about how to configure sources can be found in sources.list(5).
Package and version choices can be expressed via apt_preferences(5).
Security details are available in apt-secure(8).
This APT has Super Cow Powers.
"
1. Type "apt list" to list all the installed packages.
2. Type "apt search <package name>" to search in package descriptions.
3. Type "apt show <package name>" to show package details.
4. Type "apt install <package name>" to install packages.
5. Type "apt reinstall <package name>" to reinstall packages.
6. Type "apt remove <package name>" to remove packages.
7. Type "apt autoremove" to automatically remove all unused packages.
8. Type "apt update" to update list of available packages.
9. Type "apt upgrade" to upgrade the system by installing/upgrading packages.
10. Type "apt full-upgrade" to upgrade the system by removing/installing/upgrading packages.
11. Type "apt list --upgradable" to list packages that can be upgraded.

** Use "sudo" to run the commands as the root user.
* Install python package => sudo apt install python3
* To verify the installation of python => python3 --version

#! Linux File System
1. In Windows, we have "C:\" as the root directory. Inside it, we have directories such as "Program Files", "Users", etc.
2. In Linux, we have "/" as the root directory. Inside it, we have directories such as:
* "bin"
* "boot"
* "dev"
* "etc"
* "home"
* "root"
* "lib"
* "var"
* "proc", etc

3. In Linux, everything is a file. We can create a file using the "touch" command.

#! Navigating The File System
1. Type "pwd" to print the present working directory.
2. Type "ls" to list the files in the current directory.
3. Type "ls -a" to list the files in the current directory with hidden files.
4. Type "ls -1" to list the files in the current directory in single line format.
5. Type "ls -l" to list the files in the current directory with details.
6. Type "cd" to change the current directory.
7. Type "cd bin" to change the current directory to "bin". "bin" contains all the binaries, libraries, etc.
8. Type "cd /" to change the current directory to "/" i.e the root or base directory.
9. Type "cd ~" to change the current directory to "~" i.e the /home directory but for root users, ~ means /root directory.
For regular users, cd ~ changes the directory to /home/$USER.
For the root user, cd ~ changes the directory to /root.

#! Manipulating Files and Directories
1. Type "mkdir <directory name>" to create a new directory.
2. Type "mv <old file name> <new file name>" to rename a file.
3. Type "rm <file name>" to delete a file.
4. Type "touch <file name>" to create a new file.
5. Type "touch file1.txt file2.txt file3.txt" to create multiple files.
6. Type "mv hello.txt /abcd" to move the file "hello.txt" to the directory "/abcd"
7. Type "rm -rf /abcd" to delete the directory "/abcd"
rm: This is the basic command used to remove files or directories.
-r or -R: This option tells rm to remove directories and their contents recursively. Without this option, rm would not remove directories.
-f: This option forces the deletion of files and directories without prompting for confirmation. Normally, rm might ask for confirmation if a file is write-protected, but -f bypasses this check.
/abcd: Specifies the target directory to be removed. In this case, it refers to a directory named abcd located at the root (/) of the filesystem.

#! Editing and Viewing Files
1. "apt install nano"
2. "nano hello.txt"
3. Type "cat hello.txt" to view the content of a file.
4. Type "echo "Hello World" > hello.txt" to write a text to a file.
5. Type "more hello.txt" to view the content of a file in multiple lines.
6. Type "less hello.txt" to view the content of a file in multiple lines.
7. Type "head -n 5 hello.txt" to view the first 5 lines of a file.
8. Type "tail -n 5 hello.txt" to view the last 5 lines of a file.